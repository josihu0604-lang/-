const { prisma }=require('../prisma'); const { randomBytes }=require('crypto'); module.exports=async function(app){ app.post('/tokens', async(req,reply)=>{ if(!req.userId) return reply.code(401).send({error:'UNAUTHORIZED'}); const token='qetta_live_'+randomBytes(18).toString('hex'); await prisma.apiToken.create({ data:{ userId:req.userId, name:'default', token, scopes:['verify:write'] } }); return { token }; }); };
